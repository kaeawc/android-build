name: "Commit"

on:
  push:
    branches: [ "main" ]
  pull_request:
    paths:
      - '.github/'
      - 'app/'
      - 'build.gradle.kts'
      - 'settings.gradle.kts'
      - 'gradle/wrapper/'
      - 'gradle.properties'

jobs:
  unit_tests:
    name: "Unit Tests"
    runs-on: ubuntu-latest
    env:
      GRADLE_BUILD_ACTION_CACHE_DEBUG_ENABLED: true
    steps:
      - name: Git Checkout
        uses: actions/checkout@v4

      - name: Gradle Wrapper Validation
        uses: gradle/wrapper-validation-action@v1

      - name: Install JDK
        uses: actions/setup-java@v3
        with:
          distribution: 'zulu'
          java-version: '20'

      - uses: gradle/gradle-build-action@v2
        with:
          # This ages all gc.properties files in the Gradle User Home cache.
          gradle-home-cache-cleanup: true

          # Always save the Gradle User Home cache.
          cache-read-only: false

          # Don't reuse cache entries from any other Job.
          gradle-home-cache-strict-match: true

          arguments: testDebugUnitTest --continue --stacktrace --scan

      - name: "Publish Test Report"
        uses: mikepenz/action-junit-report@v4
        if: success() || failure() # always run even if the previous step fails
        with:
          report_paths: '**/build/test-results/test/TEST-*.xml'
